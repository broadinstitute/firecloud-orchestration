swagger: '2.0'

info:
  title: FireCloud
  description: |
    Genome analysis execution service.
  version: "0.0.1"
  license:
    name: BSD
    url: http://opensource.org/licenses/BSD-3-Clause
  termsOfService: https://github.com/broadinstitute/firecloud-orchestration

basePath: /service/api

paths:
  /workspaces:
    get:
      tags:
      - Workspaces
      operationId: listWorkspaces
      summary: |
        Lists workspaces.
      produces:
      - application/json
      - text/plain
      responses:
        200:
          description: List of workspaces.
  /methods:
    get:
      tags:
      - Method Repository
      operationId: listMethodRepositoryMethods
      summary: |
        Lists Method Repository methods.
      produces:
      - application/json
      responses:
        200:
          description: List of Method Repository methods.
  /configurations:
    get:
      tags:
      - Method Repository
      operationId: listMethodRepositoryConfigurations
      summary: |
        List Method Repository configurations.
      produces:
      - application/json
      responses:
        200:
          description: List of Method Repository configurations.
  /template:
    post:
      tags:
        - Method Repository
        - Workspaces
      operationId: createMethodTemplate
      summary: Create a Method Configuration template from a Method
      produces:
        - application/json
      parameters:
        - name: methodName
          description: name of Method to use for template
          required: true
          type: string
          in: body
          schema:
            $ref: MethodID
      responses:
        200:
          description: Method Configuration template
        400:
          description: Method WDL can't be parsed
        404:
          description: No Such Method
        500:
          description: Internal Server Error
  /configurations/{namespace}/{name}/{snapshotId}:
    get:
      tags:
        - Method Repository
      operationId: getMethodRepositoryConfiguration
      summary: Get a Method Repository configuration
      produces:
        - application/json
      parameters:
        - name: namespace
          description: Method Configuration namespace
          required: true
          type: string
          in: path
        - name: name
          description: Method Configuration name
          required: true
          type: string
          in: path
        - name: snapshotId
          description: Method Configuration snapshot ID
          required: true
          type: string
          in: path
      responses:
        200:
          description: Method Repository configuration detail
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}:
    get:
      tags:
        - Workspaces
      operationId: getWorkspace
      summary: Get workspace
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
      responses:
        200:
          description: Successful Request
        404:
          description: Workspace does not exist
        500:
          description: Internal Server Error
    delete:
      tags:
        - Workspaces
      operationId: deleteWorkspace
      summary: Delete workspace
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
      responses:
        202:
          description: Request Accepted
        404:
          description: Workspace does not exist
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/acl:
    get:
      tags:
        - Workspaces
      operationId: getWorkspaceAcl
      summary: Get workspace ACL
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
      responses:
        200:
          description: Successful Request
        400:
          description: Can't retrieve ACL for workspace
        404:
          description: Workspace not found
        500:
          description: Internal Server Error
    patch:
      tags:
        - Workspaces
      operationId: updateWorkspaceACL
      summary: Update workspace ACL
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: aclUpdates
          description: Series of ACL updates for workspace
          required: true
          type: List[Map[string, string]]
          in: body
      responses:
        200:
          description: Successful Request
        400:
          description: Can't set ACL for workspace
        404:
          description: Workspace not found
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/clone:
    post:
      tags:
        - Workspaces
      operationId: cloneWorkspace
      summary: Clone Workspace
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
      responses:
        201:
          description: Successful Request
        400:
          description: Unable to create resources for workspace
        404:
          description: Source workspace not found
        409:
          description: Destination workspace already exists
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/entities_with_type:
    get:
      type: EntityWithType
      tags:
      - Entities
      operationId: getEntitiesWithType
      summary: |
        List of entities in a workspace with type and attribute information
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
      responses:
        200:
          description: List of entities
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/entities:
    get:
      type: String
      tags:
      - Entities
      operationId: getEntityTypes
      summary: |
        List of entity types in a workspace
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
      responses:
        200:
          description: List of entity types in workspace
        404:
          description: Workspace does not exist
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/entities/copy:
    post:
      tags:
      - Entities
      operationId: copyEntities
      summary: |
        Copy entities from one workspace to another
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Destination Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Destination Workspace Name
          required: true
          type: string
          in: path
        - name: body
          description: Entities to Copy
          required: true
          in: body
          schema:
            $ref: CopyEntity
      responses:
        200:
          description: No response was specified
        201:
          description: Successful Request
        404:
          description: Source Workspace or source entities does not exist
        409:
          description: One or more entities of that name/type already exist
        500:
          description: Internal Error
  /workspaces/{workspaceNamespace}/{workspaceName}/entities/{entityType}:
    get:
      type: Entity
      tags:
      - Entities
      operationId: getEntities
      summary: |
        List of entities in a workspace
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: entityType
          description: Entity Type
          required: true
          type: string
          in: path
      responses:
        200:
          description: List of entities in workspace
        404:
          description: Workspace or entity type does not exist
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/method_configs:
    get:
      tags:
        - Method Configurations
        - Workspaces
      operationId: listWorkspaceMethodConfigs
      summary: List of Method Configurations in a workspace
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
      responses:
        200:
          description: List of Method Configurations
        404:
          description: Workspace does not exist
        500:
          description: Internal Server Error
    post:
      tags:
        - Method Configurations
        - Workspaces
      operationId: postWorkspaceMethodConfig
      summary: Create a Method Configuration in a workspace
      produces:
        - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: methodConfigJson
          description: Method Configuration contents
          required: true
          type: string
          in: body
          schema:
            $ref: NewMethodConfigIngest
      responses:
        201:
          description: Successful Request
        404:
          description: Workspace not found
        409:
          description: Method Configuration already exists
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/method_configs/{configNamespace}/{configName}:
    get:
      tags:
        - Method Configurations
      operationId: getWorkspaceMethodConfig
      summary: Get a method configuration in a workspace
      produces: application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: configNamespace
          description: Configuration Namespace
          required: true
          type: string
          in: path
        - name: configName
          description: Configuration Name
          required: true
          type: string
          in: path
      responses:
        200:
          description: Successful
        404:
          description: Workspace or Method Configuration not found
        500:
          description: Internal Server Error
    put:
      tags:
        - Method Configurations
      operationId: updateWorkspaceMethodConfig
      summary: Update a method configuration in a workspace
      produces: application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: configNamespace
          description: Configuration Namespace
          required: true
          type: string
          in: path
        - name: configName
          description: Configuration Name
          required: true
          type: string
          in: path
        - name: body
          description: Method Config to Update
          required: true
          type: string
          in: body
          schema:
            $ref: ConfigurationIngest
      responses:
        200:
          description: Successful
        404:
          description: Workspace or Method Configuration not found
        500:
          description: Internal Server Error
    delete:
      tags:
        - Method Configurations
      operationId: deleteWorkspaceMethodConfig
      summary: Delete a method configuration in a workspace
      produces: application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: configNamespace
          description: Configuration Namespace
          required: true
          type: string
          in: path
        - name: configName
          description: Configuration Name
          required: true
          type: string
          in: path
      responses:
        200:
          description: Successful request
        404:
          description: Workspace or Method Configuration not found
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/method_configs/{configNamespace}/{configName}/rename:
    post:
      tags:
        - Method Configurations
      operationId: renameWorkspaceMethodConfig
      summary: Rename a method configuration in a workspace
      produces: application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: configNamespace
          description: Configuration Namespace
          required: true
          type: string
          in: path
        - name: configName
          description: Configuration Name
          required: true
          type: string
          in: path
        - name: rename
          description: Method Config Rename
          required: true
          type: string
          in: body
          schema:
            $ref: MethodConfigRename
      responses:
        204:
          description: Successful request
        404:
          description: Workspace or Method Configuration not found
        409:
          description: Method Configuration with that name already exists
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/method_configs/copyFromMethodRepo:
    post:
      tags:
        - Method Configurations
        - Method Repository
      operationId: copyFromMethodRepo
      summary: Copy a Method Repository Configuration into a workspace
      produces: application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: configToCopy
          description: Method Configuration to Copy
          required: true
          type: string
          in: body
          schema:
            $ref: CopyConfigurationIngest
      responses:
        201:
          description: Successful request
        404:
          description: Source method configuration does not exist
        409:
          description: Destination method configuration by that name already exists
        422:
          description: Error parsing source method configuration
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/method_configs/copyToMethodRepo:
    post:
      tags:
        - Method Configurations
        - Method Repository
      operationId: copyToMethodRepo
      summary: Copy a Method Config in a workspace to the Method Repository
      produces: application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: configToCopy
          description: Method Configuration to Copy
          required: true
          type: string
          in: body
          schema:
            $ref: PublishConfigurationIngest
      responses:
        201:
          description: Successful request
        404:
          description: Source method configuration does not exist
        409:
          description: Destination method configuration by that name already exists
        422:
          description: Error parsing source method configuration
        500:
          description: Internal Server Error
  /workspaces/{workspaceNamespace}/{workspaceName}/submissions:
    get:
      tags:
      - Submissions
      operationId: listSubmissions
      summary: |
        List submissions.
      produces:
      - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
      responses:
        200:
          description: List of submissions
        404:
          description: Workspace not found
        500:
          description: Internal Error
    post:
      tags:
      - Submissions
      operationId: createSubmission
      summary: |
        Create a submission.
      produces:
      - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: submission
          description: Post Submission
          required: true
          type: string
          in: body
          schema:
            $ref: SubmissionIngest
      responses:
        201:
          description: Successful Request
        400:
          description: Expression eval failed or entities are not of type required by method config
        404:
          description: Method Configuration or Entity not found
        409:
          description: Method Configuration failed to resolve input expressions with the supplied Entity
        500:
          description: Internal Error
  /workspaces/{workspaceNamespace}/{workspaceName}/submissions/{submissionId}:
    delete:
      tags:
      - Submissions
      operationId: deleteSubmission
      summary: |
        abort a submission
      produces:
      - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: submissionId
          description: Submission ID
          required: true
          type: string
          in: path
      responses:
        204:
          description: successful deletion
        404:
          description: Submission not found
        500:
          description: Internal Error
    get:
      tags:
      - Submissions
      operationId: monitorSubmission
      summary: |
        Monitor submission status
      produces:
      - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: submissionId
          description: Submission ID
          required: true
          type: string
          in: path
      responses:
        200:
          description: monitor a submission status
        404:
          description: Submission not found
        500:
          description: Internal Error
  /workspaces/{workspaceNamespace}/{workspaceName}/submissions/{submissionId}/workflows/{workflowId}/outputs:
    get:
      tags:
      - Submissions
      operationId: workflowOutputsInSubmission
      summary: |
        Get workflow outputs.
      produces:
      - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: submissionId
          description: Submission ID
          required: true
          type: string
          in: path
        - name: workflowId
          description: Workflow ID
          required: true
          type: string
          in: path
      responses:
        200:
          description: Get workflow outputs
        404:
          description: Submission or Workflow not found
        500:
          description: Internal Error
          
  /workspaces/{workspaceNamespace}/{workspaceName}/updateAttributes:
    patch:
      tags:
      - Workspaces
      operationId: updateAttributes
      summary: |
        Modify attributes on a workspace.
      produces:
      - application/json
      parameters:
        - name: workspaceNamespace
          description: Workspace Namespace
          required: true
          type: string
          in: path
        - name: workspaceName
          description: Workspace Name
          required: true
          type: string
          in: path
        - name: workspaceUpdateJson
          description: Attribute operations
          required: true
          type: array
          items:
            $ref: AttributeUpdateOperation
          in: body
      responses:
        200:
          description: Success
        400:
          description: Invalid operation
        404:
          description: Workspace not found
        500:
          description: Internal Error
  /status:
    get:
      tags:
      - Status
      operationId: status
      summary: |
        Returns the workspace service url, methods repository url, and the current timestamp.
      produces:
      - application/json
      parameters:
      responses:
        200:
          description: Success
        500:
          description: Internal Error
  /status/ping:
    get:
      tags:
      - Status
      operationId: ping
      summary: |
        Returns the current timestamp.
      produces:
      - text/plain
      parameters:
      responses:
        200:
          description: Success
        500:
          description: Internal Error

definitions:
  SubmissionIngest:
    properties:
      methodConfigurationNamespace:
        type: string
        description: Namespace of the method configuration to execute.
      methodConfigurationName:
        type: string
        description: Name of the method configuration to execute.
      entityType:
        type: string
        description: Type of root entity for expression.
      entityName:
        type: string
        description: Name of root entity for expression.
      expression:
        type: string
        description: Expression that resolves to one or more entities matching the entity type
          in the method configuration. Leave blank for default.
    required:
      - methodConfigurationNamespace
      - methodConfigurationName
      - entityType
      - entityName
  ConfigurationIngest:
    properties:
      namespace:
        type: string
        description: Method configuration namespace
      name:
        type: string
        description: Method configuration name
      rootEntityType:
        type: string
        description: Root entity type
      workspaceName:
        type: Map[String, String]
        description: Map with corresponding workspace-related information - name and namespace
      methodRepoMethod:
        type: Map[String, String]
        description: Map with corresponding method-related information
      outputs:
        type: Map[String, String]
        description: Map with outputs information
      inputs:
        type: Map[String, String]
        description: Map with inputs information
      prerequisites:
        type: Map[String, String]
        description: Map of prerequisites (keys unused, will be removed in the future)
    required:
      - namespace
      - name
      - rootEntityType
      - workspaceName
      - methodRepoMethod
      - outputs
      - inputs
      - prerequisites
  MethodConfigRename:
    properties:
      namespace:
        type: string
        description: Method configuration namespace
      name:
        type: string
        description: Method configuration name
      workspaceName:
        type: Map[String, String]
        description: Map with corresponding workspace-related information - name and namespace
    required:
      - namespace
      - name
      - workspaceName
  CopyConfigurationIngest:
    properties:
      configurationNamespace:
        type: string
        description: Method configuration namespace
      configurationName:
        type: string
        description: Method configuration name
      configurationSnapshotId:
        type: string
        description: Method configuration snapshot id
      destinationNamespace:
        type: string
        description: Method configuration destination namespace
      destinationName:
        type: string
        description: Method configuration destination name
    required:
      - configurationNamespace
      - configurationName
      - configurationSnapshotId
      - destinationNamespace
      - destinationName
  NewMethodConfigIngest:
    properties:
      namespace:
        type: string
        description: Method configuration namespace
      name:
        type: string
        description: Method configuration name
      rootEntityType:
        type: string
        description: Method configuration root entity type
      inputs:
        type: Map[string, string]
        description: Input map
      outputs:
        type: Map[string, string]
        description: Output map
      prerequisites:
        type: Map[string, string]
        description: Prerequisites map
      methodRepoMethod:
        type: Map
        description: Method ID
    required:
      - namespace
      - name
      - rootEntityType
      - inputs
      - outputs
      - prerequisites
      - methodRepoMethod
  PublishConfigurationIngest:
    properties:
      configurationNamespace:
        type: string
        description: Method configuration namespace
      configurationName:
        type: string
        description: Method configuration name
      sourceNamespace:
        type: string
        description: Method configuration source namespace
      sourceName:
        type: string
        description: Method configuration source name
    required:
      - configurationNamespace
      - configurationName
      - sourceNamespace
      - sourceName
  AttributeUpdateOperation:
    properties:
      op:
        type: string
        description: Operation to perform on the attribute
      attributeName:
        type: string
        description: The name of the attribute
      addUpdateAttribute:
        type: string
        description: The value of the attribute (if adding/updating)
    required:
      - op
      - attributeName
  CopyEntity:
    properties:
      sourceWorkspace:
        schema:
          $ref: Namespace
        description: Source Workspace Namespace
      entityType:
        type: string
        description: Entity Type
      entityNames:
        type: array
        items:
          type: string
        description: List of entity names to be copied
  Namespace:
    properties:
      namespace:
        type: string
        description: Entity namespace
      name:
        type: string
        description: Entity name
  MethodID:
    properties:
      methodNamespace:
        type: string
        description: Method namespace
      methodName:
        type: string
        description: Method name
      methodVersion:
        type: int
        description: Method version
    required:
      - methodNamespace
      - methodName
      - methodVersion
